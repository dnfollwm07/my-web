# 可靠傳輸 - TCP

## 目錄
- [TCP協議](#TCP協議)
- [報文格式：頭部+數據](#報文格式：頭部+數據)
- [三次握手](#三次握手)
- [過長拆分（MTU/MSS）](#過長拆分（MTU/MSS）)


## TCP協議
- HTTP 是基于 TCP 协议传输的

## 報文格式：頭部+數據
1. 源端口號（16）
2. 目的端口號（16）
3. 序號（32）：解决**包乱序**的问题
4. 確認序列（32）：确认发出去对方是否有收到，解决**丢包**的问题
5. 狀態位：TCP 是**面向连接**的，因而双方要维护连接的状态，这些带状态位的包的发送，会引起双方的状态变更
   - SYN 是发起一个连接
   - ACK 是回复
   - RST 是重新连接
   - FIN 是结束连接
6. 窗口大小（16）：做**拥塞控制**
7. 校驗和（16）
8. 數據

## 三次握手
![URL結構圖](/images/notes/tcp-handshake.jpg)
0. 服務端監聽某個接口（`Listen`狀態）
1. 客戶端主動發起連接`SYN`，之後進入`SYN-SENT`
2. 服務端收到信號後發起連接，返回`SYN+ACK`（ACK是對客戶端SYN發出的確認），之後進入`SYN-RCVD`狀態
3. 客戶端收到服務端信號，發送對SYN確認的`ACK`，之後處於`ESTABLISHED`狀態
4. 服務端收到ACK後也處於`ESTABLISHED`狀態

## 過長拆分（MTU/MSS）
![MTU_MSS](/images/notes/mtu_mss.png)
- MTU：一個網絡包的最大長度，一般以太網中是1500byte
- MSS：除去IP和TCP頭部所能容納的TCP數據最大長度